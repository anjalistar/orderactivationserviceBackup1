<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Get_Add_On_Prices</name>
        <label>Get Add-On Prices</label>
        <locationX>500</locationX>
        <locationY>1032</locationY>
        <actionName>ExecuteSOQL</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>loop_PB_Priced_Lines</targetReference>
        </connector>
        <dataTypeMappings>
            <typeName>U__sObjects</typeName>
            <typeValue>AddOn_Pricebook__c</typeValue>
        </dataTypeMappings>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>soqlQuery</name>
            <value>
                <elementReference>calcAddOnPriceSOQL</elementReference>
            </value>
        </inputParameters>
        <nameSegment>ExecuteSOQL</nameSegment>
        <outputParameters>
            <assignToReference>collAddOnPricebooks</assignToReference>
            <name>sObjects</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <name>Get_Non_AddOn_Price_Book_Lines</name>
        <label>Get Non AddOn Price Book Lines</label>
        <locationX>500</locationX>
        <locationY>924</locationY>
        <actionName>ExecuteSOQL</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Get_Add_On_Prices</targetReference>
        </connector>
        <dataTypeMappings>
            <typeName>U__sObjects</typeName>
            <typeValue>Price_Book_Line__c</typeValue>
        </dataTypeMappings>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>soqlQuery</name>
            <value>
                <elementReference>calcPriceBookLineSOQL</elementReference>
            </value>
        </inputParameters>
        <nameSegment>ExecuteSOQL</nameSegment>
        <outputParameters>
            <assignToReference>collPriceBookLines</assignToReference>
            <name>sObjects</name>
        </outputParameters>
    </actionCalls>
    <apiVersion>57.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>asgn_Add_On_Plan_Id</name>
        <label>asgn Add-On Plan Id</label>
        <locationX>588</locationX>
        <locationY>1548</locationY>
        <assignmentItems>
            <assignToReference>collPricePlanIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>loop_Add_On_Prices.Price_Plan__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>loop_Add_On_Prices</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_AddOn_USD_Line_Item_Price</name>
        <label>asgn AddOn USD Line Item Price</label>
        <locationX>478</locationX>
        <locationY>4176</locationY>
        <assignmentItems>
            <assignToReference>varOppUSDTotalPrice</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varLineItemUSDPrice</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>asgn_Blank_AddOn_Prices</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_Blank_AddOn_Prices</name>
        <label>asgn Blank AddOn Prices</label>
        <locationX>478</locationX>
        <locationY>4284</locationY>
        <assignmentItems>
            <assignToReference>collFilteredAddOnPrices</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>collBlankAddOnPrices</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>loop_Filtered_AddOn_Prices</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_Filter_AddOn_Prices</name>
        <label>asgn Filter AddOn Prices</label>
        <locationX>390</locationX>
        <locationY>3528</locationY>
        <assignmentItems>
            <assignToReference>collFilteredAddOnPrices</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Filter_Add_On_Prices</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>loop_Filtered_AddOn_Prices</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_Filtered_Add_On_Tiers</name>
        <label>asgn Filtered Add On Tiers</label>
        <locationX>478</locationX>
        <locationY>3960</locationY>
        <assignmentItems>
            <assignToReference>collFilteredAddOnTiers</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Filter_Add_On_Tiers</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_AddOn_Line_Price</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_Filtered_Non_Add_On_Tiers_for_loop</name>
        <label>asgn Filtered Non Add On Tiers for loop</label>
        <locationX>478</locationX>
        <locationY>2712</locationY>
        <assignmentItems>
            <assignToReference>collFilteredNonAddOnTiers</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Filter_Tiers</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_NonAdd_On_Line_Price</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_Found_Tiers</name>
        <label>asgn Found Tiers</label>
        <locationX>214</locationX>
        <locationY>2064</locationY>
        <assignmentItems>
            <assignToReference>collFoundTiers</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Price_Tiers2</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>collTiersForLoop</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Price_Tiers2</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>loop_Subscription_Line</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_OppLineProduct</name>
        <label>asgn OppLineProduct</label>
        <locationX>390</locationX>
        <locationY>2280</locationY>
        <assignmentItems>
            <assignToReference>varSubLineProd</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loop_Subscription_Line.Product__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOppLineQty</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loop_Subscription_Line.Quantity_Numeric__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Filter_Price_Book_Lines</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_Plan_Id</name>
        <label>asgn Plan Id</label>
        <locationX>588</locationX>
        <locationY>1248</locationY>
        <assignmentItems>
            <assignToReference>collPricePlanIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>loop_PB_Priced_Lines.WPE_Price_Plan__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>loop_PB_Priced_Lines</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_Sub_Line_Price_Plan</name>
        <label>asgn Sub Line Price Plan</label>
        <locationX>478</locationX>
        <locationY>3744</locationY>
        <assignmentItems>
            <assignToReference>varSubAdddOnLinePricePlan</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loop_Filtered_AddOn_Prices.Price_Plan__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Filter_Add_On_Tiers</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_SubLineProduct</name>
        <label>asgn SubLineProduct</label>
        <locationX>390</locationX>
        <locationY>3312</locationY>
        <assignmentItems>
            <assignToReference>varSubLineProd</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loop_Priced_Add_Ons.Product__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOppLineQty</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loop_Priced_Add_Ons.Quantity_Numeric__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Filter_Add_On_Prices</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_Subscription_Rec</name>
        <label>asgn Subscription Rec</label>
        <locationX>500</locationX>
        <locationY>492</locationY>
        <assignmentItems>
            <assignToReference>SubRec_In</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Subcription_Rec</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Priced_Subscription_Lines</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>asgn_USD_Line_Item_Price</name>
        <label>asgn USD Line Item Price</label>
        <locationX>478</locationX>
        <locationY>2928</locationY>
        <assignmentItems>
            <assignToReference>varOppUSDTotalPrice</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varLineItemUSDPrice</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>loop_Filtered_PB_Lines</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <name>Filter_Add_On_Prices</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter Add-On Prices</label>
        <locationX>390</locationX>
        <locationY>3420</locationY>
        <assignNextValueToReference>currentItem_Filter_Add_On_Prices</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>collAddOnPricebooks</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_Add_On_Prices.ProductItem__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>varSubLineProd</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>asgn_Filter_AddOn_Prices</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>Filter_Add_On_Tiers</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter Add-On Tiers</label>
        <locationX>478</locationX>
        <locationY>3852</locationY>
        <assignNextValueToReference>currentItem_Filter_Add_On_Tiers</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>collFoundTiers</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_Add_On_Tiers.Price_Plan__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>loop_Filtered_AddOn_Prices.Price_Plan__c</elementReference>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_Filter_Add_On_Tiers.Above_From_Quantity__c</leftValueReference>
            <operator>LessThanOrEqualTo</operator>
            <rightValue>
                <elementReference>loop_Priced_Add_Ons.Quantity_Numeric__c</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>asgn_Filtered_Add_On_Tiers</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>Filter_Price_Book_Lines</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter Price Book Lines</label>
        <locationX>390</locationX>
        <locationY>2388</locationY>
        <assignNextValueToReference>currentItem_Filter_Price_Book_Lines_0</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>collPriceBookLines</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_Price_Book_Lines_0.Product__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>loop_Subscription_Line.Product__c</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>loop_Filtered_PB_Lines</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>Filter_Tiers</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter Tiers</label>
        <locationX>478</locationX>
        <locationY>2604</locationY>
        <assignNextValueToReference>currentItem_Filter_Tiers_0_0</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>collFoundTiers</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_Tiers_0_0.Price_Plan__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>loop_Filtered_PB_Lines.WPE_Price_Plan__c</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>asgn_Filtered_Non_Add_On_Tiers_for_loop</targetReference>
        </connector>
    </collectionProcessors>
    <decisions>
        <name>dcn_Amount_0</name>
        <label>dcn Amount &gt; 0</label>
        <locationX>665</locationX>
        <locationY>276</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Subscription_has_Price_OR_Mrr</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Total_MRR__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Subcription_Rec</targetReference>
            </connector>
            <label>Subscription has Price OR Mrr</label>
        </rules>
    </decisions>
    <decisions>
        <name>dcn_Price_Plans_Available</name>
        <label>dcn Price Plans Available</label>
        <locationX>500</locationX>
        <locationY>1740</locationY>
        <defaultConnector>
            <targetReference>Update_Subscription_USD_Price</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Price_Plans_Found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>collPricePlanIds</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Price_Tiers2</targetReference>
            </connector>
            <label>Price Plans Found</label>
        </rules>
    </decisions>
    <decisions>
        <name>dcn_Tiers_Found</name>
        <label>dcn Tiers Found</label>
        <locationX>346</locationX>
        <locationY>1956</locationY>
        <defaultConnector>
            <targetReference>Update_Subscription_USD_Price</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Tiers_Available</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Price_Tiers2</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>asgn_Found_Tiers</targetReference>
            </connector>
            <label>Tiers Available</label>
        </rules>
    </decisions>
    <description>04May23 - CC(SDA) - call the new price tier calculation subflow</description>
    <environments>Default</environments>
    <formulas>
        <name>calcAddOnLineUSDPRice</name>
        <dataType>Number</dataType>
        <expression>{!loop_Priced_Add_Ons.Quantity_Numeric__c} * {!varAddOnTierValue}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>calcAddOnOnlySOQL</name>
        <dataType>String</dataType>
        <expression>&quot;Select Id,Name, Price_Plan__c, ProductCode__c, ProductItem__c, Recurrence__c, Subscription_plan__c, CurrencyIsoCode, CreatedDate FROM AddOn_Pricebook__c WHERE ProductItem__c IN (Select PRoduct2Id from OpportunityLineItem WHERE OpportunityId = &apos;&quot; +{!OppRec_In.Id} + &quot;&apos; AND TotalPrice &gt; 0) AND Recurrence__c = &apos;Monthly&apos; AND Subscription_Plan__c = &apos;&quot; + {!OppRec_In.Subscription__r.Subscription_plan__c} + &quot;&apos; AND CurrencyIsoCode = &apos;USD&apos;&quot;</expression>
    </formulas>
    <formulas>
        <name>calcAddOnPriceSOQL</name>
        <dataType>String</dataType>
        <expression>&quot;Select Id,Name, Price_Plan__c, ProductCode__c, ProductItem__c, Recurrence__c, Subscription_plan__c, CurrencyIsoCode, CreatedDate FROM AddOn_Pricebook__c WHERE ProductItem__c IN (Select PRoduct__c from Subscription_Line__c WHERE Subscription__c = &apos;&quot; +{!SubRec_In.Id} + &quot;&apos; AND MRR__c &gt; 0) AND Recurrence__c = &apos;Monthly&apos; AND Subscription_Plan__c = &apos;&quot; + {!SubRec_In.Subscription_plan__c} + &quot;&apos; AND CurrencyIsoCode = &apos;USD&apos;&quot;</expression>
    </formulas>
    <formulas>
        <name>calcOppUSDGross</name>
        <dataType>Number</dataType>
        <expression>IF(ISPICKVAL({!$Record.Price_book_NetSuite__r.Price_Book_Term__c},&quot;Annually&quot;),{!varOppUSDTotalPrice}/0.92,{!varOppUSDTotalPrice})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>calcPriceBookLineSOQL</name>
        <dataType>String</dataType>
        <expression>&quot;select Id, WPE_Price_Plan__c,Product__c FROM Price_Book_Line__c where Price_book_NetSuite__c = &apos;&quot; + {!Get_USD_Pricebook.Id} + &quot;&apos; AND Product__c IN (Select Product__c FROM Subscription_Line__c WHERE Subscription__C = &apos;&quot; + {!SubRec_In.Id} + &quot;&apos; AND MRR__c &gt; 0) AND Price_book_NetSuite__r.Price_Book_Term__c = &apos;Monthly&apos; AND Price_book_NetSuite__r.Subscription_Plan__c = &apos;&quot; + {!SubRec_In.Subscription_plan__c} + &quot;&apos; AND CurrencyIsoCode = &apos;USD&apos;&quot;</expression>
    </formulas>
    <formulas>
        <name>calcPriceTierSOQL</name>
        <dataType>String</dataType>
        <expression>&quot;select Id,Above_From_Quantity__c, Maximum_Amount__c, Minimum_Account__c, Name, PriceBookId__c, Pricing_Option__c, Value__c from Price_Tier__c where Price_Plan__c IN (&quot; + {!varPricePlanIds} + &quot;)&quot;</expression>
    </formulas>
    <formulas>
        <name>calcSubUSDGross</name>
        <dataType>Number</dataType>
        <expression>IF(OR(ISPICKVAL({!$Record.Opportunity__r.WPE_Price_book_NetSuite__r.Price_Book_Term__c},&quot;Annually&quot;),ISPICKVAL({!$Record.Price_book_NetSuite__r.Price_Book_Term__c},&quot;Annually&quot;)),{!varOppUSDTotalPrice}/0.92,{!varOppUSDTotalPrice})</expression>
        <scale>2</scale>
    </formulas>
    <interviewLabel>Get Subscription Current USD {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Get Subscription Current USD</label>
    <loops>
        <name>loop_Add_On_Prices</name>
        <label>loop Add-On Prices</label>
        <locationX>500</locationX>
        <locationY>1440</locationY>
        <collectionReference>collAddOnPricebooks</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>asgn_Add_On_Plan_Id</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>dcn_Price_Plans_Available</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>loop_Filtered_AddOn_Prices</name>
        <label>loop Filtered AddOn Prices</label>
        <locationX>390</locationX>
        <locationY>3636</locationY>
        <collectionReference>collFilteredAddOnPrices</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>asgn_Sub_Line_Price_Plan</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>loop_Priced_Add_Ons</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>loop_Filtered_PB_Lines</name>
        <label>loop Filtered PB Lines</label>
        <locationX>390</locationX>
        <locationY>2496</locationY>
        <collectionReference>Filter_Price_Book_Lines</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Filter_Tiers</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>loop_Subscription_Line</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>loop_PB_Priced_Lines</name>
        <label>loop PB Priced Lines</label>
        <locationX>500</locationX>
        <locationY>1140</locationY>
        <collectionReference>collPriceBookLines</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>asgn_Plan_Id</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>loop_Add_On_Prices</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>loop_Priced_Add_Ons</name>
        <label>loop Priced Add-Ons</label>
        <locationX>214</locationX>
        <locationY>3204</locationY>
        <collectionReference>Get_Priced_Subscription_Lines</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>asgn_SubLineProduct</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Subscription_USD_Price</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>loop_Subscription_Line</name>
        <label>loop Subscription_Line</label>
        <locationX>214</locationX>
        <locationY>2172</locationY>
        <collectionReference>Get_Priced_Subscription_Lines</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>asgn_OppLineProduct</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>loop_Priced_Add_Ons</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Price_Tiers2</name>
        <label>Get Price Tiers2</label>
        <locationX>346</locationX>
        <locationY>1848</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>dcn_Tiers_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Price_Plan__c</field>
            <operator>In</operator>
            <value>
                <elementReference>collPricePlanIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Price_Tier__c</object>
        <sortField>Above_From_Quantity__c</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Priced_AddOn_Opp_Lines</name>
        <label>Get Priced AddOn Opp Lines</label>
        <locationX>500</locationX>
        <locationY>708</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_USD_Pricebook</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>OppRec_In.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>TotalPrice</field>
            <operator>GreaterThan</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </filters>
        <filters>
            <field>Catalog_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Add-On</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>OpportunityLineItem</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Priced_Subscription_Lines</name>
        <label>Get Priced Subscription Lines</label>
        <locationX>500</locationX>
        <locationY>600</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Priced_AddOn_Opp_Lines</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Subscription__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>SubRec_In.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>MRR__c</field>
            <operator>GreaterThan</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Subscription_Line__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Subcription_Rec</name>
        <label>Get Subcription Rec</label>
        <locationX>500</locationX>
        <locationY>384</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>asgn_Subscription_Rec</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Subscription__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_USD_Pricebook</name>
        <label>Get USD Pricebook</label>
        <locationX>500</locationX>
        <locationY>816</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Non_AddOn_Price_Book_Lines</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>CurrencyIsoCode</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>USD</stringValue>
            </value>
        </filters>
        <filters>
            <field>Price_Book_Term__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Monthly</stringValue>
            </value>
        </filters>
        <filters>
            <field>Subscription_plan__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>SubRec_In.Subscription_plan__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Price_books_NetSuite__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Subscription_USD_Price</name>
        <label>Update Subscription USD Price</label>
        <locationX>500</locationX>
        <locationY>4728</locationY>
        <inputAssignments>
            <field>Current_USD_Price__c</field>
            <value>
                <elementReference>varOppUSDTotalPrice</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Total_MRR__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Source__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Flywheel</stringValue>
            </value>
        </filters>
        <filters>
            <field>Source__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>BAPI</stringValue>
            </value>
        </filters>
        <object>Subscription__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <scheduledPaths>
            <connector>
                <targetReference>dcn_Amount_0</targetReference>
            </connector>
            <pathType>AsyncAfterCommit</pathType>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>Get_AddOn_Line_Price</name>
        <label>Get AddOn Line Price</label>
        <locationX>478</locationX>
        <locationY>4068</locationY>
        <connector>
            <targetReference>asgn_AddOn_USD_Line_Item_Price</targetReference>
        </connector>
        <flowName>Calculate_Tier_Price_for_Subscription_Lines</flowName>
        <inputAssignments>
            <name>colPriceTierRecords</name>
            <value>
                <elementReference>collFilteredAddOnTiers</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NumQuantity</name>
            <value>
                <elementReference>varOppLineQty</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>varLineItemUSDPrice</assignToReference>
            <name>CurrOutputPriceValue</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <name>Get_NonAdd_On_Line_Price</name>
        <label>Get NonAdd On Line Price</label>
        <locationX>478</locationX>
        <locationY>2820</locationY>
        <connector>
            <targetReference>asgn_USD_Line_Item_Price</targetReference>
        </connector>
        <flowName>Calculate_Tier_Price_for_Subscription_Lines</flowName>
        <inputAssignments>
            <name>colPriceTierRecords</name>
            <value>
                <elementReference>collFilteredNonAddOnTiers</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NumQuantity</name>
            <value>
                <elementReference>varOppLineQty</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>varLineItemUSDPrice</assignToReference>
            <name>CurrOutputPriceValue</name>
        </outputAssignments>
    </subflows>
    <triggerOrder>1300</triggerOrder>
    <variables>
        <name>collAddOnPricebooks</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AddOn_Pricebook__c</objectType>
    </variables>
    <variables>
        <name>collBlankAddOnPrices</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AddOn_Pricebook__c</objectType>
    </variables>
    <variables>
        <name>collBlankTiers</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>collFilteredAddOnPrices</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AddOn_Pricebook__c</objectType>
    </variables>
    <variables>
        <name>collFilteredAddOnTiers</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>collFilteredNonAddOnTiers</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>collFoundTiers</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>collPriceBookLines</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Book_Line__c</objectType>
    </variables>
    <variables>
        <name>collPricedPlanIds</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Plan__c</objectType>
    </variables>
    <variables>
        <name>collPriceLines</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Plan__c</objectType>
    </variables>
    <variables>
        <name>collPricePlanIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>collTiersForLoop</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_Add_On_Prices</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AddOn_Pricebook__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_Add_On_Tiers</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_AddOn_Prices</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AddOn_Pricebook__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_AddOn_Tiers_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>currentItem_filter_Non_AddOns</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Book_Line__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_PB_Lines_for_No_Add_On_Product</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Book_Line__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_Price_Book_Lines_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Book_Line__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_Tiers</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_Tiers_0_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>currentItemFromSourceCollection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Plan__c</objectType>
    </variables>
    <variables>
        <name>currentItemFromSourceCollection_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>currentItemFromSourceCollection_0_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AddOn_Pricebook__c</objectType>
    </variables>
    <variables>
        <name>currentItemFromSourceCollection_0_0_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Price_Tier__c</objectType>
    </variables>
    <variables>
        <name>OppRec_In</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>SubRec_In</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Subscription__c</objectType>
    </variables>
    <variables>
        <name>varAddOnTierValue</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>varLineItemUSDPrice</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>varOppAddOnLineQty</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>varOppLineQty</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>varOppUSDTotalPrice</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>varPricePlanIds</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varSubAdddOnLinePricePlan</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varSubLineProd</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
